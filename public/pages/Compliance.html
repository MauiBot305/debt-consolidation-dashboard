<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compliance Center - Debt Consolidation Empire</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700&display=swap');

    :root {
      --bg-primary: #0a0f1a;
      --bg-card: rgba(15, 23, 42, 0.8);
      --bg-glass: rgba(30, 41, 59, 0.6);
      --primary: #3B82F6;
      --primary-glow: rgba(59, 130, 246, 0.3);
      --accent: #06B6D4;
      --accent-glow: rgba(6, 182, 212, 0.3);
      --success: #22C55E;
      --success-glow: rgba(34, 197, 94, 0.3);
      --warning: #F59E0B;
      --warning-glow: rgba(245, 158, 11, 0.3);
      --danger: #EF4444;
      --danger-glow: rgba(239, 68, 68, 0.3);
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --border-subtle: rgba(148, 163, 184, 0.1);
      --border-hover: rgba(148, 163, 184, 0.2);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      padding: 2rem;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--border-subtle);
    }

    .header h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--success), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .competitive-edge {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(245, 158, 11, 0.1));
      border: 1px solid var(--danger);
      border-radius: 0.75rem;
      padding: 1rem 1.5rem;
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .competitive-edge-text {
      flex: 1;
    }

    .competitive-edge-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      color: var(--danger);
      margin-bottom: 0.25rem;
    }

    .competitive-edge-subtitle {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .competitive-edge-amount {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--danger);
    }

    .glass-card {
      background: var(--bg-glass);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border-subtle);
      border-radius: 1rem;
      padding: 1.5rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .glass-card:hover {
      border-color: var(--border-hover);
      box-shadow: 0 0 30px rgba(59, 130, 246, 0.1);
    }

    .top-section {
      display: grid;
      grid-template-columns: 350px 1fr;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    /* Compliance Score Gauge */
    .score-gauge {
      text-align: center;
      padding: 2rem 1rem;
    }

    .score-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.25rem;
      margin-bottom: 1.5rem;
      color: var(--text-secondary);
    }

    .gauge-wrapper {
      position: relative;
      width: 200px;
      height: 200px;
      margin: 0 auto 1rem;
    }

    .gauge-circle {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: conic-gradient(
        var(--success) 0% var(--score-percent),
        rgba(148, 163, 184, 0.1) var(--score-percent) 100%
      );
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .gauge-circle::before {
      content: '';
      position: absolute;
      width: 160px;
      height: 160px;
      background: var(--bg-card);
      border-radius: 50%;
    }

    .gauge-value {
      position: relative;
      z-index: 1;
      font-family: 'Orbitron', sans-serif;
      font-size: 3rem;
      font-weight: 900;
      color: var(--success);
    }

    .gauge-status {
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      font-weight: 600;
      margin-top: 0.5rem;
    }

    .alert-summary {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .alert-box {
      text-align: center;
      padding: 0.75rem;
      border-radius: 0.5rem;
      background: rgba(148, 163, 184, 0.05);
    }

    .alert-box-value {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.75rem;
      font-weight: 700;
    }

    .alert-box-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    /* License Grid */
    .license-grid-wrapper {
      padding: 1.5rem;
    }

    .license-grid-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.25rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .license-grid {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 0.5rem;
    }

    .license-cell {
      aspect-ratio: 1;
      background: rgba(148, 163, 184, 0.05);
      border: 1px solid var(--border-subtle);
      border-radius: 0.375rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .license-cell:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .license-cell.active {
      background: var(--success);
      color: white;
      border-color: var(--success);
      box-shadow: 0 0 15px var(--success-glow);
    }

    .license-cell.pending {
      background: var(--warning);
      color: white;
      border-color: var(--warning);
    }

    .license-cell.expired {
      background: var(--danger);
      color: white;
      border-color: var(--danger);
    }

    .license-cell.not-required {
      background: rgba(148, 163, 184, 0.1);
      color: var(--text-muted);
    }

    .license-legend {
      display: flex;
      gap: 1.5rem;
      margin-top: 1rem;
      font-size: 0.75rem;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    /* Main Content Grid */
    .main-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    /* Checklist */
    .checklist-section h3 {
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .checklist-category {
      margin-bottom: 1.5rem;
    }

    .category-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .checklist-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      border-radius: 0.5rem;
      margin-bottom: 0.5rem;
      background: rgba(148, 163, 184, 0.03);
      cursor: pointer;
      transition: all 0.2s;
    }

    .checklist-item:hover {
      background: rgba(148, 163, 184, 0.08);
    }

    .checklist-checkbox {
      width: 20px;
      height: 20px;
      border: 2px solid var(--border-subtle);
      border-radius: 0.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .checklist-item.completed .checklist-checkbox {
      background: var(--success);
      border-color: var(--success);
    }

    .checklist-item.completed .checklist-checkbox::after {
      content: '‚úì';
      color: white;
      font-size: 14px;
      font-weight: bold;
    }

    .checklist-label {
      flex: 1;
      font-size: 0.875rem;
    }

    /* TCPA Tracker */
    .tcpa-section h3 {
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .tcpa-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .tcpa-stat {
      text-align: center;
      padding: 0.75rem;
      background: rgba(148, 163, 184, 0.05);
      border-radius: 0.5rem;
    }

    .tcpa-stat-value {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent);
    }

    .tcpa-stat-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    .tcpa-table {
      max-height: 300px;
      overflow-y: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      text-align: left;
      padding: 0.75rem;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-muted);
      border-bottom: 1px solid var(--border-subtle);
      position: sticky;
      top: 0;
      background: var(--bg-glass);
      backdrop-filter: blur(20px);
    }

    td {
      padding: 0.75rem;
      font-size: 0.875rem;
      border-bottom: 1px solid var(--border-subtle);
    }

    tr:hover {
      background: rgba(148, 163, 184, 0.05);
    }

    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .status-badge.verified {
      background: var(--success-glow);
      color: var(--success);
    }

    .status-badge.pending {
      background: var(--warning-glow);
      color: var(--warning);
    }

    /* DNC Section */
    .dnc-section h3 {
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .dnc-header {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .dnc-input {
      flex: 1;
      padding: 0.75rem;
      background: rgba(148, 163, 184, 0.05);
      border: 1px solid var(--border-subtle);
      border-radius: 0.5rem;
      color: var(--text-primary);
      font-size: 0.875rem;
    }

    .dnc-input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.5rem;
      font-family: 'Orbitron', sans-serif;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--accent);
      box-shadow: 0 0 20px var(--primary-glow);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-success:hover {
      box-shadow: 0 0 20px var(--success-glow);
    }

    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
    }

    .dnc-list {
      max-height: 200px;
      overflow-y: auto;
    }

    .dnc-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem;
      background: rgba(148, 163, 184, 0.03);
      border-radius: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .dnc-phone {
      font-family: 'Orbitron', sans-serif;
      font-size: 0.875rem;
    }

    .btn-danger {
      background: var(--danger);
      color: white;
      padding: 0.25rem 0.75rem;
      font-size: 0.75rem;
    }

    /* Audit Log */
    .audit-section h3 {
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .audit-log {
      max-height: 400px;
      overflow-y: auto;
    }

    .audit-entry {
      padding: 0.75rem;
      background: rgba(148, 163, 184, 0.03);
      border-left: 3px solid var(--accent);
      border-radius: 0.25rem;
      margin-bottom: 0.75rem;
    }

    .audit-timestamp {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }

    .audit-action {
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .audit-user {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 1rem;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
    }

    .modal-header {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.25rem;
      margin-bottom: 1.5rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    .form-input {
      width: 100%;
      padding: 0.75rem;
      background: rgba(148, 163, 184, 0.05);
      border: 1px solid var(--border-subtle);
      border-radius: 0.5rem;
      color: var(--text-primary);
      font-size: 0.875rem;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .form-select {
      width: 100%;
      padding: 0.75rem;
      background: rgba(148, 163, 184, 0.05);
      border: 1px solid var(--border-subtle);
      border-radius: 0.5rem;
      color: var(--text-primary);
      font-size: 0.875rem;
    }

    .modal-actions {
      display: flex;
      gap: 0.75rem;
      margin-top: 1.5rem;
    }

    .btn-secondary {
      background: rgba(148, 163, 184, 0.2);
      color: var(--text-primary);
    }

    .btn-secondary:hover {
      background: rgba(148, 163, 184, 0.3);
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 0.75rem;
      padding: 1rem 1.5rem;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      gap: 0.75rem;
      z-index: 2000;
    }

    .toast.active {
      display: flex;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .toast-success {
      border-left: 4px solid var(--success);
    }

    .toast-error {
      border-left: 4px solid var(--danger);
    }

    /* Action Bar */
    .action-bar {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .btn-icon {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(148, 163, 184, 0.05);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.2);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(148, 163, 184, 0.3);
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <h1>
      üõ°Ô∏è Compliance Center
    </h1>
    <button class="btn btn-success btn-icon" onclick="generateReport()">
      üìÑ Generate Report
    </button>
  </div>

  <!-- Competitive Edge Alert -->
  <div class="competitive-edge">
    <div class="competitive-edge-text">
      <div class="competitive-edge-title">‚ö†Ô∏è YOUR COMPETITIVE ADVANTAGE</div>
      <div class="competitive-edge-subtitle">StratusBK & Talkt have ZERO compliance certifications. You're exposed to:</div>
    </div>
    <div class="competitive-edge-amount">$3.5M - $14.9M</div>
  </div>

  <!-- Top Section: Score + License Grid -->
  <div class="top-section">
    <!-- Compliance Score Gauge -->
    <div class="glass-card score-gauge">
      <div class="score-title">Compliance Score</div>
      <div class="gauge-wrapper">
        <div class="gauge-circle" id="gaugeCircle">
          <div class="gauge-value" id="gaugeValue">0%</div>
        </div>
      </div>
      <div class="gauge-status" id="gaugeStatus">Calculating...</div>
      
      <div class="alert-summary">
        <div class="alert-box">
          <div class="alert-box-value" style="color: var(--success);" id="completedCount">0</div>
          <div class="alert-box-label">Completed</div>
        </div>
        <div class="alert-box">
          <div class="alert-box-value" style="color: var(--warning);" id="pendingCount">0</div>
          <div class="alert-box-label">Pending</div>
        </div>
        <div class="alert-box">
          <div class="alert-box-value" style="color: var(--danger);" id="expiringCount">0</div>
          <div class="alert-box-label">Expiring</div>
        </div>
      </div>
    </div>

    <!-- State License Grid -->
    <div class="glass-card license-grid-wrapper">
      <div class="license-grid-title">üìã State Licensing (50 States)</div>
      <div class="license-grid" id="licenseGrid"></div>
      <div class="license-legend">
        <div class="legend-item">
          <div class="legend-dot" style="background: var(--success);"></div>
          <span>Active ‚úÖ</span>
        </div>
        <div class="legend-item">
          <div class="legend-dot" style="background: var(--warning);"></div>
          <span>Pending üü°</span>
        </div>
        <div class="legend-item">
          <div class="legend-dot" style="background: var(--danger);"></div>
          <span>Expired üî¥</span>
        </div>
        <div class="legend-item">
          <div class="legend-dot" style="background: rgba(148, 163, 184, 0.2);"></div>
          <span>Not Required ‚ö™</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="main-grid">
    <!-- Left Column: Compliance Checklist -->
    <div class="glass-card checklist-section">
      <h3>‚úÖ Compliance Checklist</h3>
      <div id="checklistContainer"></div>
    </div>

    <!-- Right Column: TCPA Tracker -->
    <div class="glass-card tcpa-section">
      <h3>üìû TCPA Consent Tracker</h3>
      <div class="tcpa-stats">
        <div class="tcpa-stat">
          <div class="tcpa-stat-value" id="tcpaTotal">0</div>
          <div class="tcpa-stat-label">Total Consents</div>
        </div>
        <div class="tcpa-stat">
          <div class="tcpa-stat-value" id="tcpaVerified">0</div>
          <div class="tcpa-stat-label">Verified</div>
        </div>
        <div class="tcpa-stat">
          <div class="tcpa-stat-value" id="tcpaPending">0</div>
          <div class="tcpa-stat-label">Pending</div>
        </div>
      </div>
      <div class="dnc-header">
        <input type="text" class="dnc-input" id="tcpaLeadName" placeholder="Lead Name">
        <input type="text" class="dnc-input" id="tcpaPhone" placeholder="Phone">
        <button class="btn btn-primary btn-sm" onclick="addTCPAConsent()">Add</button>
      </div>
      <div class="tcpa-table">
        <table>
          <thead>
            <tr>
              <th>Lead</th>
              <th>Phone</th>
              <th>Date</th>
              <th>Method</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="tcpaTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- DNC + Audit Grid -->
  <div class="main-grid">
    <!-- DNC List -->
    <div class="glass-card dnc-section">
      <h3>üö´ Do Not Call (DNC) List</h3>
      <div class="dnc-header">
        <input type="text" class="dnc-input" id="dncPhone" placeholder="Phone Number">
        <button class="btn btn-primary" onclick="addDNC()">Add to DNC</button>
        <button class="btn btn-secondary" onclick="importDNC()">Import CSV</button>
      </div>
      <div style="margin-bottom: 1rem;">
        <span style="font-family: 'Orbitron'; font-size: 1.25rem; color: var(--accent);" id="dncCount">0</span>
        <span style="color: var(--text-muted); font-size: 0.875rem;"> numbers on DNC list</span>
      </div>
      <div class="dnc-list" id="dncList"></div>
    </div>

    <!-- Audit Log -->
    <div class="glass-card audit-section">
      <h3>üìù Audit Log</h3>
      <div class="audit-log" id="auditLog"></div>
    </div>
  </div>

  <!-- License Edit Modal -->
  <div class="modal" id="licenseModal">
    <div class="modal-content">
      <div class="modal-header">Edit License: <span id="modalState"></span></div>
      <div class="form-group">
        <label class="form-label">License Number</label>
        <input type="text" class="form-input" id="licenseNumber" placeholder="e.g., IL-12345">
      </div>
      <div class="form-group">
        <label class="form-label">Expiry Date</label>
        <input type="date" class="form-input" id="licenseExpiry">
      </div>
      <div class="form-group">
        <label class="form-label">Status</label>
        <select class="form-select" id="licenseStatus">
          <option value="active">Active ‚úÖ</option>
          <option value="pending">Pending üü°</option>
          <option value="expired">Expired üî¥</option>
          <option value="not-required">Not Required ‚ö™</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Notes</label>
        <input type="text" class="form-input" id="licenseNotes" placeholder="Additional notes">
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" onclick="closeLicenseModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveLicense()">Save License</button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast">
    <span id="toastMessage"></span>
  </div>

  <script>
(function() {
'use strict';

    // State abbreviations
    const US_STATES = [
      'AL', 'AK', 'AZ', 'AR', 'CA', 'CO', 'CT', 'DE', 'FL', 'GA',
      'HI', 'ID', 'IL', 'IN', 'IA', 'KS', 'KY', 'LA', 'ME', 'MD',
      'MA', 'MI', 'MN', 'MS', 'MO', 'MT', 'NE', 'NV', 'NH', 'NJ',
      'NM', 'NY', 'NC', 'ND', 'OH', 'OK', 'OR', 'PA', 'RI', 'SC',
      'SD', 'TN', 'TX', 'UT', 'VT', 'VA', 'WA', 'WV', 'WI', 'WY'
    ];

    // Operating states for DebtStoppers
    const OPERATING_STATES = ['IL', 'MI', 'GA', 'FL', 'TX'];

    // Compliance checklist structure
    const COMPLIANCE_CHECKLIST = [
      {
        category: 'üèõÔ∏è Federal Compliance',
        items: [
          { id: 'tsr', label: 'Telemarketing Sales Rule (TSR) compliance documented' },
          { id: 'tcpa', label: 'TCPA consent management system active' },
          { id: 'fdcpa', label: 'Fair Debt Collection Practices Act (FDCPA) training completed' },
          { id: 'ftc', label: 'FTC Act Section 5 consumer protection review' },
          { id: 'cfpb', label: 'CFPB debt collection rules implemented' }
        ]
      },
      {
        category: 'üè¢ State Compliance',
        items: [
          { id: 'state_lic', label: 'All operating state licenses current' },
          { id: 'state_bond', label: 'Surety bonds filed in required states' },
          { id: 'state_reg', label: 'State registration documents on file' },
          { id: 'state_annual', label: 'Annual state reports submitted' }
        ]
      },
      {
        category: 'üîê Data Protection (HIPAA Readiness)',
        items: [
          { id: 'hipaa_policy', label: 'HIPAA policies and procedures documented' },
          { id: 'phi_encryption', label: 'PHI (Protected Health Information) encrypted at rest' },
          { id: 'phi_transit', label: 'PHI encrypted in transit (TLS 1.3)' },
          { id: 'access_control', label: 'Role-based access controls (RBAC) implemented' },
          { id: 'breach_plan', label: 'Breach notification plan documented' },
          { id: 'baa', label: 'Business Associate Agreements (BAA) signed' },
          { id: 'audit_trail', label: 'Comprehensive audit logging active' }
        ]
      },
      {
        category: 'üéØ SOC 2 Control Framework',
        items: [
          { id: 'soc2_security', label: 'Security controls documented' },
          { id: 'soc2_availability', label: 'Availability monitoring in place' },
          { id: 'soc2_integrity', label: 'Data integrity checks automated' },
          { id: 'soc2_confidentiality', label: 'Confidentiality policies enforced' },
          { id: 'soc2_privacy', label: 'Privacy controls implemented' }
        ]
      },
      {
        category: '‚öñÔ∏è Operations',
        items: [
          { id: 'call_recording', label: 'Call recording consent protocols active' },
          { id: 'fee_disclosure', label: 'Fee disclosure templates current' },
          { id: 'contract_req', label: 'Contract requirements checklist complete' },
          { id: 'complaint_proc', label: 'Complaint handling procedures documented' },
          { id: 'qc_calls', label: 'Quality control call audits scheduled' }
        ]
      }
    ];

    let currentLicenseState = null;
    let tcpaConsents = [];

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      initializeCompliance();
      renderLicenseGrid();
      renderChecklist();
      renderTCPATable();
      renderDNCList();
      renderAuditLog();
      updateComplianceScore();
    });

    function initializeCompliance() {
      // Initialize compliance data if not exists
      if (!(window.DebtDB?.getComplianceChecklist?.() || []).length) {
        COMPLIANCE_CHECKLIST.forEach(cat => {
          cat.items.forEach(item => {
            window.DebtDB.updateComplianceItem(item.id, {
              id: item.id,
              label: item.label,
              category: cat.category,
              completed: false
            });
          });
        });
      }

      // Initialize licenses for operating states
      const existingLicenses = window.DebtDB.getLicenses();
      OPERATING_STATES.forEach(state => {
        if (!existingLicenses.find(l => l.state === state)) {
          window.DebtDB.updateLicense(state, {
            status: 'active',
            licenseNumber: `${state}-ACTIVE-2026`,
            expiryDate: '2027-12-31',
            notes: 'Primary operating state'
          });
        }
      });

      // Load TCPA consents from storage
      const stored = localStorage.getItem('tcpa_consents');
      if (stored) {
        tcpaConsents = JSON.parse(stored);
      }
    }

    function renderLicenseGrid() {
      const grid = document.getElementById('licenseGrid');
      if (!grid) return; // Guard against SPA race condition
      const licenses = window.DebtDB.getLicenses();
      
      grid.innerHTML = US_STATES.map(state => {
        const license = licenses.find(l => l.state === state);
        let statusClass = 'not-required';
        
        if (license) {
          statusClass = license.status || 'not-required';
        } else if (OPERATING_STATES.includes(state)) {
          statusClass = 'active';
        }
        
        return `<div class="license-cell ${statusClass}" onclick="openLicenseModal('${state}')">${state}</div>`;
      }).join('');

      updateExpiringCount();
    }

    function renderChecklist() {
      const container = document.getElementById('checklistContainer');
      if (!container) return;
      const checklist = (window.DebtDB?.getComplianceChecklist?.() || []);
      
      container.innerHTML = COMPLIANCE_CHECKLIST.map(cat => {
        const items = cat.items.map(item => {
          const dbItem = checklist.find(c => c.id === item.id);
          const completed = dbItem?.completed || false;
          return `
            <div class="checklist-item ${completed ? 'completed' : ''}" onclick="toggleChecklistItem('${item.id}')">
              <div class="checklist-checkbox"></div>
              <div class="checklist-label">${item.label}</div>
            </div>
          `;
        }).join('');
        
        return `
          <div class="checklist-category">
            <div class="category-title">${cat.category}</div>
            ${items}
          </div>
        `;
      }).join('');
    }

    function renderTCPATable() {
      const tbody = document.getElementById('tcpaTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = tcpaConsents.map(consent => {
        const statusClass = consent.status === 'verified' ? 'verified' : 'pending';
        return `
          <tr>
            <td>${consent.leadName}</td>
            <td style="font-family: 'Orbitron';">${consent.phone}</td>
            <td>${consent.date}</td>
            <td>${consent.method}</td>
            <td><span class="status-badge ${statusClass}">${consent.status}</span></td>
          </tr>
        `;
      }).join('');

      // Update stats
      document.getElementById('tcpaTotal').textContent = tcpaConsents.length;
      document.getElementById('tcpaVerified').textContent = tcpaConsents.filter(c => c.status === 'verified').length;
      document.getElementById('tcpaPending').textContent = tcpaConsents.filter(c => c.status === 'pending').length;
    }

    function renderDNCList() {
      const list = document.getElementById('dncList');
      if (!list) return;
      const dncNumbers = window.DebtDB.getDNCList();
      
      document.getElementById('dncCount').textContent = dncNumbers.length;
      
      list.innerHTML = dncNumbers.map(phone => `
        <div class="dnc-item">
          <div class="dnc-phone">${phone}</div>
          <button class="btn btn-danger" onclick="removeDNC('${phone}')">Remove</button>
        </div>
      `).join('');
    }

    function renderAuditLog() {
      const log = document.getElementById('auditLog');
      if (!log) return;
      const entries = window.DebtDB.getAuditLog().slice(0, 20);
      
      log.innerHTML = entries.map(entry => {
        const date = new Date(entry.timestamp);
        return `
          <div class="audit-entry">
            <div class="audit-timestamp">${date.toLocaleString()}</div>
            <div class="audit-action">${formatAuditAction(entry)}</div>
            <div class="audit-user">by ${entry.user}</div>
          </div>
        `;
      }).join('');
    }

    function formatAuditAction(entry) {
      const actions = {
        'dnc_added': `Added ${entry.phone} to DNC list`,
        'dnc_removed': `Removed ${entry.phone} from DNC list`,
        'compliance_updated': `Updated compliance item`,
        'license_updated': `Updated license for ${entry.state}`
      };
      return actions[entry.action] || entry.action;
    }

    function updateComplianceScore() {
      const checklist = (window.DebtDB?.getComplianceChecklist?.() || []);
      const completed = checklist.filter(item => item.completed).length;
      const total = checklist.length;
      const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
      
      // Update gauge
      const gauge = document.getElementById('gaugeCircle');
      if (!gauge) return;
      gauge.style.setProperty('--score-percent', percentage + '%');
      document.getElementById('gaugeValue').textContent = percentage + '%';
      
      // Update status
      const statusEl = document.getElementById('gaugeStatus');
      if (percentage >= 80) {
        statusEl.textContent = '‚úÖ Excellent';
        statusEl.style.color = 'var(--success)';
      } else if (percentage >= 60) {
        statusEl.textContent = '‚ö†Ô∏è Good';
        statusEl.style.color = 'var(--warning)';
      } else {
        statusEl.textContent = 'üî¥ Needs Attention';
        statusEl.style.color = 'var(--danger)';
      }
      
      // Update counts
      document.getElementById('completedCount').textContent = completed;
      document.getElementById('pendingCount').textContent = total - completed;
    }

    function updateExpiringCount() {
      const licenses = window.DebtDB.getLicenses();
      const today = new Date();
      const thirtyDaysFromNow = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);
      
      const expiring = licenses.filter(license => {
        if (!license.expiryDate) return false;
        const expiryDate = new Date(license.expiryDate);
        return expiryDate <= thirtyDaysFromNow && expiryDate >= today;
      }).length;
      
      document.getElementById('expiringCount').textContent = expiring;
    }

    function toggleChecklistItem(id) {
      const checklist = (window.DebtDB?.getComplianceChecklist?.() || []);
      const item = checklist.find(c => c.id === id);
      
      if (item) {
        window.DebtDB.updateComplianceItem(id, { completed: !item.completed });
        window.DebtDB.addAuditEntry({ 
          action: 'compliance_updated', 
          data: { item: id, completed: !item.completed }
        });
        renderChecklist();
        updateComplianceScore();
        showToast('Compliance item updated', 'success');
      }
    }

    function openLicenseModal(state) {
      currentLicenseState = state;
      const licenses = window.DebtDB.getLicenses();
      const license = licenses.find(l => l.state === state);
      
      document.getElementById('modalState').textContent = state;
      document.getElementById('licenseNumber').value = license?.licenseNumber || '';
      document.getElementById('licenseExpiry').value = license?.expiryDate || '';
      document.getElementById('licenseStatus').value = license?.status || 'not-required';
      document.getElementById('licenseNotes').value = license?.notes || '';
      
      document.getElementById('licenseModal').classList.add('active');
    }

    function closeLicenseModal() {
      document.getElementById('licenseModal').classList.remove('active');
      currentLicenseState = null;
    }

    function saveLicense() {
      if (!currentLicenseState) return;
      
      const data = {
        licenseNumber: document.getElementById('licenseNumber').value,
        expiryDate: document.getElementById('licenseExpiry').value,
        status: document.getElementById('licenseStatus').value,
        notes: document.getElementById('licenseNotes').value
      };
      
      window.DebtDB.updateLicense(currentLicenseState, data);
      window.DebtDB.addAuditEntry({ 
        action: 'license_updated', 
        state: currentLicenseState,
        data 
      });
      
      renderLicenseGrid();
      renderAuditLog();
      closeLicenseModal();
      showToast(`License updated for ${currentLicenseState}`, 'success');
    }

    function addTCPAConsent() {
      const leadName = document.getElementById('tcpaLeadName').value.trim();
      const phone = document.getElementById('tcpaPhone').value.trim();
      
      if (!leadName || !phone) {
        showToast('Please enter lead name and phone', 'error');
        return;
      }
      
      tcpaConsents.push({
        leadName,
        phone,
        date: new Date().toISOString().split('T')[0],
        method: 'verbal',
        status: 'verified'
      });
      
      localStorage.setItem('tcpa_consents', JSON.stringify(tcpaConsents));
      
      document.getElementById('tcpaLeadName').value = '';
      document.getElementById('tcpaPhone').value = '';
      
      renderTCPATable();
      showToast('TCPA consent recorded', 'success');
    }

    function addDNC() {
      const phone = document.getElementById('dncPhone').value.trim();
      
      if (!phone) {
        showToast('Please enter a phone number', 'error');
        return;
      }
      
      window.DebtDB.addToDNC(phone);
      document.getElementById('dncPhone').value = '';
      renderDNCList();
      renderAuditLog();
      showToast('Added to DNC list', 'success');
    }

    function removeDNC(phone) {
      window.DebtDB.removeFromDNC(phone);
      renderDNCList();
      renderAuditLog();
      showToast('Removed from DNC list', 'success');
    }

    function importDNC() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.csv';
      input.onchange = function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function(event) {
          const csv = event.target.result;
          const lines = csv.split('\n');
          let count = 0;
          lines.forEach(line => {
            const phone = line.trim();
            if (phone) {
              window.DebtDB.addToDNC(phone);
              count++;
            }
          });
          renderDNCList();
          showToast(`Imported ${count} numbers to DNC list`, 'success');
        };
        reader.readAsText(file);
      };
      input.click();
    }

    function generateReport() {
      const checklist = (window.DebtDB?.getComplianceChecklist?.() || []);
      const licenses = window.DebtDB.getLicenses();
      const dncList = window.DebtDB.getDNCList();
      const auditLog = window.DebtDB.getAuditLog();
      
      const completed = checklist.filter(item => item.completed).length;
      const total = checklist.length;
      const percentage = Math.round((completed / total) * 100);
      
      const report = {
        generatedAt: new Date().toISOString(),
        complianceScore: percentage,
        checklist: checklist,
        licenses: licenses,
        dncCount: dncList.length,
        tcpaConsents: tcpaConsents.length,
        auditEntries: auditLog.length,
        operatingStates: OPERATING_STATES,
        summary: {
          totalItems: total,
          completed: completed,
          pending: total - completed,
          activeLicenses: licenses.filter(l => l.status === 'active').length
        }
      };
      
      // Download as JSON
      const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `compliance-report-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      
      showToast('Compliance report generated', 'success');
    }

    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toastMessage');
      
      toastMessage.textContent = message;
      toast.className = `toast toast-${type} active`;
      
      setTimeout(() => {
        toast.classList.remove('active');
      }, 3000);
    }

    // Close modal on outside click
    document.getElementById('licenseModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeLicenseModal();
      }
    });

  // Expose functions to window for onclick handlers
  window.addDNC = addDNC;
  window.addTCPAConsent = addTCPAConsent;
  window.closeLicenseModal = closeLicenseModal;
  window.generateReport = generateReport;
  window.importDNC = importDNC;
  window.initializeCompliance = initializeCompliance;
  window.openLicenseModal = openLicenseModal;
  window.removeDNC = removeDNC;
  window.saveLicense = saveLicense;
  window.toggleChecklistItem = toggleChecklistItem;
})();
</script>
</body>
</html>
