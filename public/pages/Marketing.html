<!-- Marketing - SPA Fragment (converted from standalone) -->
<div class="marketing-page p-6 max-w-7xl mx-auto">
  <!-- Header -->
  <div class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-3xl font-bold text-white mb-1">Marketing Command Center</h1>
      <p class="text-gray-400">Campaigns, lead sources, and conversion optimization</p>
    </div>
    <button onclick="openCampaignModal()" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-xl font-semibold hover:shadow-lg hover:shadow-blue-500/25 transition-all duration-300 flex items-center gap-2 group">
      <i data-lucide="plus" class="w-5 h-5 group-hover:rotate-90 transition-transform"></i>
      Create Campaign
    </button>
  </div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="bg-slate-800/50 backdrop-blur-xl rounded-2xl p-6 border border-blue-500/20">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center">
          <i data-lucide="megaphone" class="w-6 h-6 text-blue-400"></i>
        </div>
      </div>
      <p class="text-gray-400 text-sm mb-1">Active Campaigns</p>
      <p class="text-3xl font-bold text-white font-mono" style="font-family: 'Orbitron', monospace;" id="activeCampaigns">0</p>
    </div>

    <div class="bg-slate-800/50 backdrop-blur-xl rounded-2xl p-6 border border-cyan-500/20">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 rounded-xl bg-cyan-500/20 flex items-center justify-center">
          <i data-lucide="users" class="w-6 h-6 text-cyan-400"></i>
        </div>
      </div>
      <p class="text-gray-400 text-sm mb-1">Total Leads Generated</p>
      <p class="text-3xl font-bold text-white font-mono" style="font-family: 'Orbitron', monospace;" id="totalLeads">0</p>
    </div>

    <div class="bg-slate-800/50 backdrop-blur-xl rounded-2xl p-6 border border-emerald-500/20">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center">
          <i data-lucide="dollar-sign" class="w-6 h-6 text-emerald-400"></i>
        </div>
      </div>
      <p class="text-gray-400 text-sm mb-1">Avg Cost Per Lead</p>
      <p class="text-3xl font-bold text-white font-mono" style="font-family: 'Orbitron', monospace;" id="avgCPL">$0</p>
    </div>

    <div class="bg-slate-800/50 backdrop-blur-xl rounded-2xl p-6 border border-purple-500/20">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 rounded-xl bg-purple-500/20 flex items-center justify-center">
          <i data-lucide="percent" class="w-6 h-6 text-purple-400"></i>
        </div>
      </div>
      <p class="text-gray-400 text-sm mb-1">Conversion Rate</p>
      <p class="text-3xl font-bold text-white font-mono" style="font-family: 'Orbitron', monospace;" id="conversionRate">0%</p>
    </div>
  </div>

  <!-- Campaign List -->
  <div class="bg-slate-800/30 backdrop-blur-sm rounded-2xl border border-slate-700/50 overflow-hidden mb-8">
    <div class="p-6 border-b border-slate-700/50 flex items-center justify-between">
      <h2 class="text-xl font-semibold text-white flex items-center gap-2">
        <i data-lucide="target" class="w-5 h-5 text-blue-400"></i>
        Active Campaigns
      </h2>
      <div class="flex gap-2">
        <button onclick="filterCampaigns('all')" id="filterAll" class="px-3 py-1.5 text-sm rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 transition-colors">All</button>
        <button onclick="filterCampaigns('email')" id="filterEmail" class="px-3 py-1.5 text-sm rounded-lg hover:bg-slate-700/50 text-gray-400 transition-colors">Email</button>
        <button onclick="filterCampaigns('sms')" id="filterSMS" class="px-3 py-1.5 text-sm rounded-lg hover:bg-slate-700/50 text-gray-400 transition-colors">SMS</button>
        <button onclick="filterCampaigns('social')" id="filterSocial" class="px-3 py-1.5 text-sm rounded-lg hover:bg-slate-700/50 text-gray-400 transition-colors">Social</button>
      </div>
    </div>
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead>
          <tr class="border-b border-slate-700/50">
            <th class="text-left p-4 text-gray-400 font-medium">Campaign</th>
            <th class="text-left p-4 text-gray-400 font-medium">Type</th>
            <th class="text-left p-4 text-gray-400 font-medium">Status</th>
            <th class="text-left p-4 text-gray-400 font-medium">Budget</th>
            <th class="text-left p-4 text-gray-400 font-medium">Leads</th>
            <th class="text-left p-4 text-gray-400 font-medium">Conversions</th>
            <th class="text-left p-4 text-gray-400 font-medium">ROI</th>
            <th class="text-left p-4 text-gray-400 font-medium">Actions</th>
          </tr>
        </thead>
        <tbody id="campaignTableBody">
          <!-- Populated by JS -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Lead Source ROI -->
  <div class="bg-slate-800/30 backdrop-blur-sm rounded-2xl border border-slate-700/50 overflow-hidden">
    <div class="p-6 border-b border-slate-700/50">
      <h2 class="text-xl font-semibold text-white flex items-center gap-2">
        <i data-lucide="trending-up" class="w-5 h-5 text-emerald-400"></i>
        Lead Source ROI
      </h2>
    </div>
    <div class="p-6">
      <table class="w-full" id="leadSourceTable">
        <thead>
          <tr class="border-b border-slate-700/50">
            <th class="text-left p-2 text-gray-400 font-medium">Source</th>
            <th class="text-left p-2 text-gray-400 font-medium">Leads</th>
            <th class="text-left p-2 text-gray-400 font-medium">Conversions</th>
            <th class="text-left p-2 text-gray-400 font-medium">Conv %</th>
            <th class="text-left p-2 text-gray-400 font-medium">Cost</th>
            <th class="text-left p-2 text-gray-400 font-medium">Revenue</th>
            <th class="text-left p-2 text-gray-400 font-medium">ROI</th>
          </tr>
        </thead>
        <tbody id="leadSourceBody">
          <!-- Populated by JS -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Create Campaign Modal -->
<div id="campaignModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center">
  <div class="bg-slate-900 border border-slate-700 rounded-2xl p-8 max-w-md w-full mx-4">
    <h2 class="text-2xl font-bold text-white mb-6">Create New Campaign</h2>
    
    <div class="space-y-4">
      <div>
        <label class="block text-gray-400 text-sm mb-2">Campaign Name</label>
        <input type="text" id="newCampaignName" class="w-full px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white focus:outline-none focus:border-blue-500" placeholder="Summer Sale 2026">
      </div>
      
      <div>
        <label class="block text-gray-400 text-sm mb-2">Type</label>
        <select id="newCampaignType" class="w-full px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white focus:outline-none focus:border-blue-500">
          <option value="email">Email</option>
          <option value="sms">SMS</option>
          <option value="facebook">Facebook</option>
          <option value="google">Google Ads</option>
          <option value="tv">TV</option>
          <option value="radio">Radio</option>
          <option value="direct-mail">Direct Mail</option>
        </select>
      </div>
      
      <div>
        <label class="block text-gray-400 text-sm mb-2">Budget ($)</label>
        <input type="number" id="newCampaignBudget" class="w-full px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white focus:outline-none focus:border-blue-500" placeholder="5000">
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-gray-400 text-sm mb-2">Start Date</label>
          <input type="date" id="newCampaignStart" class="w-full px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white focus:outline-none focus:border-blue-500">
        </div>
        <div>
          <label class="block text-gray-400 text-sm mb-2">End Date</label>
          <input type="date" id="newCampaignEnd" class="w-full px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white focus:outline-none focus:border-blue-500">
        </div>
      </div>
    </div>
    
    <div class="flex gap-3 mt-6">
      <button onclick="closeCampaignModal()" class="flex-1 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors">Cancel</button>
      <button onclick="createCampaign()" class="flex-1 px-4 py-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-lg hover:shadow-lg transition-all">Create</button>
    </div>
  </div>
</div>

<script>(function() {


})();</script>
  <script src="https://unpkg.com/lucide@latest"></script>

<script>
(function() {
'use strict';
// Toast Function
  function showToast(msg, type='info') {
    const toast = document.createElement('div');
    const colors = {
      success: 'bg-emerald-500',
      error: 'bg-red-500',
      info: 'bg-blue-500'
    };
    toast.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-fade-in`;
    toast.textContent = msg;
    document.body.appendChild(toast);
    setTimeout(() => {
      toast.remove();
    }, 3000);
  }

  // Check if DebtDB is loaded
  if (!window.DebtDB) {
    showToast('DebtDB not loaded!', 'error');
  }

  let currentFilter = 'all';

  function calculateMetrics() {
    const campaigns = window.DebtDB.getCampaigns();
    const leads = (window.DebtDB?.getLeads?.() || []);
    
    const active = campaigns.filter(c => c.status === 'active').length;
    const totalLeadsFromCampaigns = campaigns.reduce((sum, c) => sum + (c.leads || 0), 0);
    const totalSpent = campaigns.reduce((sum, c) => sum + (c.spent || 0), 0);
    const totalConversions = campaigns.reduce((sum, c) => sum + (c.conversions || 0), 0);
    
    const avgCPL = totalLeadsFromCampaigns > 0 ? (totalSpent / totalLeadsFromCampaigns).toFixed(2) : 0;
    const conversionRate = totalLeadsFromCampaigns > 0 ? ((totalConversions / totalLeadsFromCampaigns) * 100).toFixed(1) : 0;
    
    document.getElementById('activeCampaigns').textContent = active;
    document.getElementById('totalLeads').textContent = totalLeadsFromCampaigns;
    document.getElementById('avgCPL').textContent = '$' + avgCPL;
    document.getElementById('conversionRate').textContent = conversionRate + '%';
  }

  function renderCampaignTable(filter = 'all') {
    currentFilter = filter;
    let campaigns = window.DebtDB.getCampaigns();
    
    if (filter !== 'all') {
      campaigns = campaigns.filter(c => c.type === filter);
    }
    
    const tbody = document.getElementById('campaignTableBody');
    tbody.innerHTML = campaigns.map(c => {
      const conv = c.conversions || 0;
      const roi = c.spent > 0 ? (((conv * 1000) - c.spent) / c.spent * 100).toFixed(1) : 0;
      const statusColors = {
        active: 'bg-emerald-500/20 text-emerald-400',
        paused: 'bg-yellow-500/20 text-yellow-400',
        completed: 'bg-gray-500/20 text-gray-400'
      };
      
      return `
        <tr class="border-b border-slate-700/30 hover:bg-slate-800/30 transition-colors">
          <td class="p-4 text-white font-medium">${c.name}</td>
          <td class="p-4 text-gray-300 capitalize">${c.type}</td>
          <td class="p-4"><span class="px-3 py-1 rounded-full text-xs font-semibold ${statusColors[c.status] || statusColors.active}">${c.status}</span></td>
          <td class="p-4 text-gray-300">$${(c.budget || 0).toLocaleString()}</td>
          <td class="p-4 text-gray-300 font-mono" style="font-family: 'Orbitron', monospace;">${c.leads || 0}</td>
          <td class="p-4 text-gray-300 font-mono" style="font-family: 'Orbitron', monospace;">${c.conversions || 0}</td>
          <td class="p-4 ${roi > 0 ? 'text-emerald-400' : 'text-red-400'} font-mono" style="font-family: 'Orbitron', monospace;">${roi}%</td>
          <td class="p-4">
            <button onclick="toggleCampaignStatus('${c.id}')" class="text-blue-400 hover:text-blue-300 mr-2">
              <i data-lucide="${c.status === 'active' ? 'pause' : 'play'}" class="w-4 h-4"></i>
            </button>
          </td>
        </tr>
      `;
    }).join('');
    
    if (typeof lucide !== 'undefined' && lucide.createIcons) { try { if (typeof lucide !== 'undefined' && lucide.createIcons) { try { lucide.createIcons(); } catch(e) { console.warn('[Lucide] createIcons failed:', e.message); } }; } catch(e) { console.warn('[Lucide] createIcons failed:', e.message); } };
  }

  function renderLeadSourceROI() {
    const leads = (window.DebtDB?.getLeads?.() || []);
    const campaigns = window.DebtDB.getCampaigns();
    
    // Aggregate by source
    const sources = {};
    leads.forEach(lead => {
      const source = lead.source || 'Direct';
      if (!sources[source]) {
        sources[source] = { leads: 0, conversions: 0, cost: 0, revenue: 0 };
      }
      sources[source].leads++;
      if (lead.stage === 'Enrolled' || lead.stage === 'In Program') {
        sources[source].conversions++;
        sources[source].revenue += (lead.estimatedValue || 500);
      }
    });
    
    // Add campaign costs
    campaigns.forEach(c => {
      const source = c.type || 'other';
      if (sources[source]) {
        sources[source].cost += (c.spent || 0);
      }
    });
    
    const tbody = document.getElementById('leadSourceBody');
    tbody.innerHTML = Object.entries(sources).map(([source, data]) => {
      const convRate = data.leads > 0 ? ((data.conversions / data.leads) * 100).toFixed(1) : 0;
      const roi = data.cost > 0 ? (((data.revenue - data.cost) / data.cost) * 100).toFixed(1) : 0;
      
      return `
        <tr class="border-b border-slate-700/30">
          <td class="p-2 text-white font-medium capitalize">${source}</td>
          <td class="p-2 text-gray-300 font-mono" style="font-family: 'Orbitron', monospace;">${data.leads}</td>
          <td class="p-2 text-gray-300 font-mono" style="font-family: 'Orbitron', monospace;">${data.conversions}</td>
          <td class="p-2 text-gray-300 font-mono" style="font-family: 'Orbitron', monospace;">${convRate}%</td>
          <td class="p-2 text-gray-300">$${data.cost.toLocaleString()}</td>
          <td class="p-2 text-gray-300">$${data.revenue.toLocaleString()}</td>
          <td class="p-2 ${roi > 0 ? 'text-emerald-400' : 'text-red-400'} font-mono font-bold" style="font-family: 'Orbitron', monospace;">${roi}%</td>
        </tr>
      `;
    }).join('');
  }

  function filterCampaigns(type) {
    // Update button styles
    ['All', 'Email', 'SMS', 'Social'].forEach(t => {
      const btn = document.getElementById('filter' + t);
      if (btn) {
        if (type === t.toLowerCase() || (type === 'all' && t === 'All')) {
          btn.className = 'px-3 py-1.5 text-sm rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 transition-colors';
        } else {
          btn.className = 'px-3 py-1.5 text-sm rounded-lg hover:bg-slate-700/50 text-gray-400 transition-colors';
        }
      }
    });
    
    renderCampaignTable(type);
  }

  function openCampaignModal() {
    document.getElementById('campaignModal').classList.remove('hidden');
    document.getElementById('campaignModal').classList.add('flex');
  }

  function closeCampaignModal() {
    document.getElementById('campaignModal').classList.add('hidden');
    document.getElementById('campaignModal').classList.remove('flex');
  }

  function createCampaign() {
    const name = document.getElementById('newCampaignName').value;
    const type = document.getElementById('newCampaignType').value;
    const budget = parseInt(document.getElementById('newCampaignBudget').value) || 0;
    const startDate = document.getElementById('newCampaignStart').value;
    const endDate = document.getElementById('newCampaignEnd').value;
    
    if (!name) {
      showToast('Campaign name is required', 'error');
      return;
    }
    
    const newCampaign = {
      name,
      type,
      status: 'active',
      budget,
      spent: 0,
      leads: 0,
      conversions: 0,
      startDate,
      endDate
    };
    
    window.DebtDB.addCampaign(newCampaign);
    showToast('Campaign created successfully!', 'success');
    
    calculateMetrics();
    renderCampaignTable(currentFilter);
    renderLeadSourceROI();
    closeCampaignModal();
    
    // Clear form
    document.getElementById('newCampaignName').value = '';
    document.getElementById('newCampaignBudget').value = '';
    document.getElementById('newCampaignStart').value = '';
    document.getElementById('newCampaignEnd').value = '';
  }

  function toggleCampaignStatus(id) {
    const campaign = window.DebtDB.getCampaigns().find(c => c.id === id);
    if (!campaign) return;
    
    const newStatus = campaign.status === 'active' ? 'paused' : 'active';
    window.DebtDB.updateCampaign(id, { status: newStatus });
    
    showToast(`Campaign ${newStatus}!`, 'success');
    renderCampaignTable(currentFilter);
  }

  // Initialize
  calculateMetrics();
  renderCampaignTable();
  renderLeadSourceROI();
  if (typeof lucide !== 'undefined' && lucide.createIcons) { try { if (typeof lucide !== 'undefined' && lucide.createIcons) { try { lucide.createIcons(); } catch(e) { console.warn('[Lucide] createIcons failed:', e.message); } }; } catch(e) { console.warn('[Lucide] createIcons failed:', e.message); } };

// Window exports for onclick handlers
  window.closeCampaignModal = closeCampaignModal;
  window.createCampaign = createCampaign;
  window.filterCampaigns = filterCampaigns;
  window.openCampaignModal = openCampaignModal;
  window.toggleCampaignStatus = toggleCampaignStatus;
})();
</script>
