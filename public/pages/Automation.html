<div class="automation-container" style="padding: 24px; max-width: 1600px; margin: 0 auto;">
  <!-- Header -->
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
    <div>
      <h1 style="font-size: 32px; font-weight: 700; color: #fff; margin: 0 0 8px 0; font-family: 'Orbitron', monospace; text-transform: uppercase; letter-spacing: 2px;">
        <i data-lucide="zap" style="width: 32px; height: 32px; color: #06B6D4; vertical-align: middle; margin-right: 12px;"></i>
        Workflow Automation
      </h1>
      <p style="color: #94a3b8; margin: 0; font-size: 14px;">Build smart automations that save time and never miss a follow-up</p>
    </div>
    <button id="createAutomationBtn" style="padding: 14px 28px; background: linear-gradient(135deg, #3B82F6, #06B6D4); border: none; border-radius: 12px; color: white; font-weight: 600; font-size: 15px; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: all 0.3s ease; box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);">
      <i data-lucide="plus" style="width: 20px; height: 20px;"></i>
      New Automation
    </button>
  </div>

  <!-- Templates Section -->
  <div style="margin-bottom: 32px;">
    <h3 style="margin: 0 0 20px 0; color: #fff; font-size: 18px; font-weight: 600; display: flex; align-items: center; gap: 10px;">
      <i data-lucide="layout-template" style="width: 20px; height: 20px; color: #3B82F6;"></i>
      Quick Start Templates
    </h3>
    
    <div id="templatesGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px;">
      <!-- Templates rendered here -->
    </div>
  </div>

  <!-- Active Automations List -->
  <div style="background: rgba(15,23,42,0.8); backdrop-filter: blur(20px); border: 1px solid rgba(59,130,246,0.2); border-radius: 16px; padding: 24px; margin-bottom: 24px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h3 style="margin: 0; color: #fff; font-size: 18px; font-weight: 600; display: flex; align-items: center; gap: 10px;">
        <i data-lucide="play-circle" style="width: 20px; height: 20px; color: #22C55E;"></i>
        Active Automations
      </h3>
      <div style="display: flex; gap: 12px;">
        <button id="viewLogsBtn" style="padding: 8px 16px; background: rgba(59,130,246,0.2); border: 1px solid rgba(59,130,246,0.3); border-radius: 8px; color: #3B82F6; font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.2s;">
          <i data-lucide="scroll-text" style="width: 14px; height: 14px;"></i>
          View Logs
        </button>
        <div style="padding: 8px 16px; background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.2); border-radius: 8px; color: #22C55E; font-size: 13px; display: flex; align-items: center; gap: 6px;">
          <span style="width: 8px; height: 8px; background: #22C55E; border-radius: 50%; animation: pulse 2s infinite;"></span>
          12 Active
        </div>
      </div>
    </div>

    <div id="automationsList" style="display: flex; flex-direction: column; gap: 12px;">
      <!-- Automation items rendered here -->
    </div>
  </div>

  <!-- Workflow Builder Section -->
  <div id="workflowBuilder" style="display: none; background: rgba(15,23,42,0.8); backdrop-filter: blur(20px); border: 1px solid rgba(59,130,246,0.2); border-radius: 16px; padding: 24px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
      <div style="display: flex; align-items: center; gap: 16px;">
        <h3 style="margin: 0; color: #fff; font-size: 18px; font-weight: 600;">Workflow Builder</h3>
        <input id="workflowName" type="text" placeholder="Name your automation..." style="padding: 10px 16px; background: rgba(10,15,26,0.8); border: 1px solid rgba(148,163,184,0.2); border-radius: 8px; color: #fff; font-size: 14px; width: 280px;">
      </div>
      <div style="display: flex; gap: 12px;">
        <button id="cancelWorkflowBtn" style="padding: 10px 20px; background: transparent; border: 1px solid rgba(148,163,184,0.3); border-radius: 8px; color: #94a3b8; font-size: 14px; cursor: pointer; transition: all 0.2s;">Cancel</button>
        <button id="saveWorkflowBtn" style="padding: 10px 24px; background: linear-gradient(135deg, #22C55E, #16a34a); border: none; border-radius: 8px; color: white; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.2s;">Save Automation</button>
      </div>
    </div>

    <!-- Node Palette -->
    <div style="display: grid; grid-template-columns: 220px 1fr; gap: 24px;">
      <!-- Sidebar: Node Types -->
      <div style="background: rgba(10,15,26,0.6); border-radius: 12px; padding: 16px;">
        <h4 style="margin: 0 0 16px 0; color: #94a3b8; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">Add Step</h4>
        
        <div style="display: flex; flex-direction: column; gap: 10px;">
          <div class="node-palette-item" data-type="trigger" style="padding: 14px; background: linear-gradient(135deg, rgba(139,92,246,0.2), rgba(139,92,246,0.1)); border: 1px solid rgba(139,92,246,0.3); border-radius: 10px; cursor: grab; transition: all 0.2s;">
            <div style="display: flex; align-items: center; gap: 10px;">
              <div style="width: 32px; height: 32px; background: rgba(139,92,246,0.3); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <i data-lucide="lightning" style="width: 16px; height: 16px; color: #8b5cf6;"></i>
              </div>
              <div>
                <div style="color: #fff; font-size: 13px; font-weight: 600;">Trigger</div>
                <div style="color: #94a3b8; font-size: 11px;">Start automation</div>
              </div>
            </div>
          </div>

          <div class="node-palette-item" data-type="action" style="padding: 14px; background: linear-gradient(135deg, rgba(59,130,246,0.2), rgba(59,130,246,0.1)); border: 1px solid rgba(59,130,246,0.3); border-radius: 10px; cursor: grab; transition: all 0.2s;">
            <div style="display: flex; align-items: center; gap: 10px;">
              <div style="width: 32px; height: 32px; background: rgba(59,130,246,0.3); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <i data-lucide="zap" style="width: 16px; height: 16px; color: #3B82F6;"></i>
              </div>
              <div>
                <div style="color: #fff; font-size: 13px; font-weight: 600;">Action</div>
                <div style="color: #94a3b8; font-size: 11px;">Do something</div>
              </div>
            </div>
          </div>

          <div class="node-palette-item" data-type="condition" style="padding: 14px; background: linear-gradient(135deg, rgba(234,179,8,0.2), rgba(234,179,8,0.1)); border: 1px solid rgba(234,179,8,0.3); border-radius: 10px; cursor: grab; transition: all 0.2s;">
            <div style="display: flex; align-items: center; gap: 10px;">
              <div style="width: 32px; height: 32px; background: rgba(234,179,8,0.3); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <i data-lucide="git-branch" style="width: 16px; height: 16px; color: #eab308;"></i>
              </div>
              <div>
                <div style="color: #fff; font-size: 13px; font-weight: 600;">Condition</div>
                <div style="color: #94a3b8; font-size: 11px;">If/Then logic</div>
              </div>
            </div>
          </div>

          <div class="node-palette-item" data-type="delay" style="padding: 14px; background: linear-gradient(135deg, rgba(6,182,212,0.2), rgba(6,182,212,0.1)); border: 1px solid rgba(6,182,212,0.3); border-radius: 10px; cursor: grab; transition: all 0.2s;">
            <div style="display: flex; align-items: center; gap: 10px;">
              <div style="width: 32px; height: 32px; background: rgba(6,182,212,0.3); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <i data-lucide="clock" style="width: 16px; height: 16px; color: #06B6D4;"></i>
              </div>
              <div>
                <div style="color: #fff; font-size: 13px; font-weight: 600;">Delay</div>
                <div style="color: #94a3b8; font-size: 11px;">Wait timer</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Canvas: Workflow Nodes -->
      <div id="workflowCanvas" style="background: rgba(10,15,26,0.6); border-radius: 12px; padding: 24px; min-height: 500px; position: relative;">
        <div id="workflowNodes" style="display: flex; flex-direction: column; align-items: center; gap: 0;">
          <!-- Start Node -->
          <div class="workflow-node trigger-node" style="width: 280px; padding: 20px; background: linear-gradient(135deg, rgba(139,92,246,0.2), rgba(139,92,246,0.1)); border: 2px solid #8b5cf6; border-radius: 16px; position: relative; z-index: 2;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 40px; height: 40px; background: rgba(139,92,246,0.3); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                <i data-lucide="play" style="width: 20px; height: 20px; color: #8b5cf6;"></i>
              </div>
              <div style="flex: 1;">
                <div style="color: #fff; font-size: 14px; font-weight: 600;">Start</div>
                <div style="color: #94a3b8; font-size: 12px;">Click to set trigger</div>
              </div>
            </div>
          </div>

          <!-- Connection Line -->
          <div style="width: 2px; height: 40px; background: linear-gradient(180deg, #8b5cf6, #3B82F6); position: relative;">
            <div class="connection-anim" style="position: absolute; width: 6px; height: 6px; background: #fff; border-radius: 50%; left: 50%; transform: translateX(-50%); animation: flowDown 1.5s linear infinite;"></div>
          </div>

          <!-- Add Step Placeholder -->
          <div id="addStepPlaceholder" style="width: 280px; padding: 30px; border: 2px dashed rgba(148,163,184,0.3); border-radius: 16px; text-align: center; cursor: pointer; transition: all 0.3s;">
            <i data-lucide="plus-circle" style="width: 32px; height: 32px; color: #94a3b8; margin-bottom: 8px;"></i>
            <div style="color: #94a3b8; font-size: 13px;">Add your first step</div>
          </div>
        </div>

        <!-- Empty State -->
        <div id="emptyWorkflowState" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
          <div style="width: 80px; height: 80px; background: rgba(59,130,246,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
            <i data-lucide="workflow" style="width: 40px; height: 40px; color: #3B82F6;"></i>
          </div>
          <div style="color: #fff; font-size: 16px; font-weight: 600; margin-bottom: 8px;">Build Your Workflow</div>
          <div style="color: #94a3b8; font-size: 13px;">Drag nodes from the sidebar or click the + button</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Automation Logs Modal -->
  <div id="logsModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: rgba(15,23,42,0.95); border: 1px solid rgba(59,130,246,0.3); border-radius: 24px; padding: 32px; max-width: 1000px; width: 90%; max-height: 80vh; overflow-y: auto;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <h2 style="margin: 0; color: #fff; font-size: 24px; font-weight: 700; display: flex; align-items: center; gap: 12px;">
          <i data-lucide="scroll-text" style="width: 28px; height: 28px; color: #3B82F6;"></i>
          Automation Logs
        </h2>
        <button id="closeLogsBtn" style="background: none; border: none; color: #94a3b8; cursor: pointer; padding: 8px; border-radius: 8px; transition: all 0.2s;">
          <i data-lucide="x" style="width: 24px; height: 24px;"></i>
        </button>
      </div>

      <!-- Filters -->
      <div style="display: flex; gap: 12px; margin-bottom: 20px;">
        <select id="logFilterStatus" style="padding: 10px 16px; background: rgba(10,15,26,0.8); border: 1px solid rgba(148,163,184,0.2); border-radius: 8px; color: #fff; font-size: 13px;">
          <option value="all">All Status</option>
          <option value="success">Success</option>
          <option value="failed">Failed</option>
          <option value="skipped">Skipped</option>
        </select>
        
        <select id="logFilterAutomation" style="padding: 10px 16px; background: rgba(10,15,26,0.8); border: 1px solid rgba(148,163,184,0.2); border-radius: 8px; color: #fff; font-size: 13px;">
          <option value="all">All Automations</option>
        </select>
        
        <input id="logDateFilter" type="date" style="padding: 10px 16px; background: rgba(10,15,26,0.8); border: 1px solid rgba(148,163,184,0.2); border-radius: 8px; color: #fff; font-size: 13px;">
      </div>

      <!-- Logs Table -->
      <div id="logsTable" style="display: flex; flex-direction: column; gap: 8px;">
        <!-- Log entries rendered here -->
      </div>
    </div>
  </div>
</div>

<style>
@keyframes flowDown {
  0% { top: 0; opacity: 0; }
  20% { opacity: 1; }
  80% { opacity: 1; }
  100% { top: 100%; opacity: 0; }
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

@keyframes slideIn {
  from { opacity: 0; transform: translateX(-10px); }
  to { opacity: 1; transform: translateX(0); }
}

.template-card {
  background: rgba(15,23,42,0.8);
  border: 1px solid rgba(59,130,246,0.2);
  border-radius: 16px;
  padding: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.template-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, #3B82F6, #06B6D4);
  transform: scaleX(0);
  transition: transform 0.3s ease;
}

.template-card:hover {
  transform: translateY(-4px);
  border-color: rgba(59,130,246,0.5);
  box-shadow: 0 10px 40px rgba(59,130,246,0.15);
}

.template-card:hover::before {
  transform: scaleX(1);
}

.automation-item {
  background: rgba(10,15,26,0.6);
  border: 1px solid rgba(59,130,246,0.1);
  border-radius: 12px;
  padding: 16px 20px;
  display: grid;
  grid-template-columns: 1fr auto auto auto auto;
  gap: 20px;
  align-items: center;
  transition: all 0.3s ease;
  animation: slideIn 0.3s ease forwards;
}

.automation-item:hover {
  border-color: rgba(59,130,246,0.3);
  background: rgba(10,15,26,0.8);
}

.toggle-switch {
  width: 48px;
  height: 26px;
  background: rgba(148,163,184,0.3);
  border-radius: 13px;
  position: relative;
  cursor: pointer;
  transition: all 0.3s ease;
}

.toggle-switch.active {
  background: #22C55E;
}

.toggle-switch::after {
  content: '';
  position: absolute;
  width: 22px;
  height: 22px;
  background: #fff;
  border-radius: 50%;
  top: 2px;
  left: 2px;
  transition: all 0.3s ease;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.toggle-switch.active::after {
  left: 24px;
}

.status-badge {
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 6px;
}

.status-success { background: rgba(34,197,94,0.2); color: #22C55E; }
.status-failed { background: rgba(239,68,68,0.2); color: #ef4444; }
.status-skipped { background: rgba(234,179,8,0.2); color: #eab308; }

.log-entry {
  background: rgba(10,15,26,0.6);
  border-radius: 10px;
  padding: 14px 18px;
  display: grid;
  grid-template-columns: auto 1fr auto auto;
  gap: 16px;
  align-items: center;
  animation: slideIn 0.3s ease forwards;
}

.log-entry:hover {
  background: rgba(10,15,26,0.8);
}

.node-palette-item:hover {
  transform: translateX(4px);
}

.node-palette-item:active {
  cursor: grabbing;
}

.workflow-step {
  width: 280px;
  padding: 20px;
  border-radius: 16px;
  position: relative;
  animation: slideIn 0.4s ease forwards;
}

.workflow-step.trigger { 
  background: linear-gradient(135deg, rgba(139,92,246,0.2), rgba(139,92,246,0.1)); 
  border: 2px solid #8b5cf6; 
}

.workflow-step.action { 
  background: linear-gradient(135deg, rgba(59,130,246,0.2), rgba(59,130,246,0.1)); 
  border: 2px solid #3B82F6; 
}

.workflow-step.condition { 
  background: linear-gradient(135deg, rgba(234,179,8,0.2), rgba(234,179,8,0.1)); 
  border: 2px solid #eab308; 
}

.workflow-step.delay { 
  background: linear-gradient(135deg, rgba(6,182,212,0.2), rgba(6,182,212,0.1)); 
  border: 2px solid #06B6D4; 
}

.workflow-connector {
  width: 2px;
  height: 40px;
  background: linear-gradient(180deg, var(--from-color), var(--to-color));
  position: relative;
}

.workflow-connector::after {
  content: '';
  position: absolute;
  width: 6px;
  height: 6px;
  background: #fff;
  border-radius: 50%;
  left: 50%;
  transform: translateX(-50%);
  animation: flowDown 1.5s linear infinite;
}
</style>

<script>
(function() {
  // Pre-built Templates
  const templates = [
    {
      id: 'new-lead-followup',
      name: 'New Lead Follow-up',
      description: 'Auto-email + SMS + task for agent when new lead enters system',
      icon: 'user-plus',
      color: '#3B82F6',
      steps: ['trigger:lead_created', 'action:send_email', 'action:send_sms', 'action:create_task']
    },
    {
      id: 'missed-payment',
      name: 'Missed Payment Alert',
      description: 'Notify client + agent + manager when payment fails',
      icon: 'alert-circle',
      color: '#ef4444',
      steps: ['trigger:payment_failed', 'action:notify_client', 'action:notify_agent', 'action:notify_manager']
    },
    {
      id: 'settlement-review',
      name: 'Settlement Offer Review',
      description: 'Route to attorney + notify client of settlement offer',
      icon: 'file-check',
      color: '#22C55E',
      steps: ['trigger:settlement_offer', 'action:route_attorney', 'action:notify_client', 'condition:client_approve']
    },
    {
      id: 'enrollment-anniversary',
      name: 'Enrollment Anniversary',
      description: 'Check-in email at 3/6/12 months in program',
      icon: 'calendar-heart',
      color: '#8b5cf6',
      steps: ['trigger:schedule', 'condition:months_enrolled', 'action:send_checkin_email']
    },
    {
      id: 'stale-lead',
      name: 'Stale Lead Reactivation',
      description: 'Re-engage after 30 days of no activity',
      icon: 'refresh-cw',
      color: '#eab308',
      steps: ['trigger:schedule', 'condition:days_inactive', 'action:send_reactivation', 'action:create_call_task']
    },
    {
      id: 'welcome-sequence',
      name: 'Welcome Sequence',
      description: '5-email drip over 14 days for new enrollments',
      icon: 'mail',
      color: '#06B6D4',
      steps: ['trigger:enrollment', 'action:send_email', 'delay:2_days', 'action:send_email', 'delay:3_days', 'action:send_email']
    }
  ];

  // Mock Active Automations
  let automations = JSON.parse(localStorage.getItem('automations') || 'null') || [
    {
      id: 'AUTO001',
      name: 'New Lead Follow-up',
      trigger: 'New Lead Created',
      actions: 'Email → SMS → Task',
      status: 'active',
      lastRun: '2026-02-24T18:45:00',
      runCount: 156
    },
    {
      id: 'AUTO002',
      name: 'Missed Payment Alert',
      trigger: 'Payment Failed',
      actions: 'Notify All',
      status: 'active',
      lastRun: '2026-02-24T17:30:00',
      runCount: 23
    },
    {
      id: 'AUTO003',
      name: 'Stale Lead Reactivation',
      trigger: 'Daily Schedule',
      actions: 'Email + Call Task',
      status: 'paused',
      lastRun: '2026-02-23T09:00:00',
      runCount: 89
    },
    {
      id: 'AUTO004',
      name: 'Welcome Email Series',
      trigger: 'Enrollment Complete',
      actions: '5-Email Drip',
      status: 'active',
      lastRun: '2026-02-24T16:20:00',
      runCount: 312
    }
  ];

  // Mock Automation Logs
  const logs = [
    { id: 'LOG001', automation: 'New Lead Follow-up', status: 'success', message: 'Executed for lead L0123 - Sarah Wilson', timestamp: '2026-02-24T18:45:00' },
    { id: 'LOG002', automation: 'Missed Payment Alert', status: 'success', message: 'Payment failed for client C0045 - Mike Brown', timestamp: '2026-02-24T17:30:00' },
    { id: 'LOG003', automation: 'Stale Lead Reactivation', status: 'skipped', message: 'No stale leads found (threshold: 30 days)', timestamp: '2026-02-24T09:00:00' },
    { id: 'LOG004', automation: 'Welcome Email Series', status: 'success', message: 'Day 1 email sent to Emily Parker', timestamp: '2026-02-24T16:20:00' },
    { id: 'LOG005', automation: 'Welcome Email Series', status: 'failed', message: 'SMTP error - retry scheduled', timestamp: '2026-02-24T15:45:00' },
    { id: 'LOG006', automation: 'New Lead Follow-up', status: 'success', message: 'Executed for lead L0122 - John Davis', timestamp: '2026-02-24T14:30:00' },
    { id: 'LOG007', automation: 'Settlement Offer Review', status: 'success', message: 'Offer routed to attorney for case C0023', timestamp: '2026-02-24T13:15:00' },
    { id: 'LOG008', automation: 'Enrollment Anniversary', status: 'success', message: '6-month check-in sent to 23 clients', timestamp: '2026-02-24T10:00:00' }
  ];

  let currentWorkflow = [];

  function init() {
    renderTemplates();
    renderAutomations();
    renderLogs();
    setupEventListeners();
  }

  function renderTemplates() {
    const grid = document.getElementById('templatesGrid');
    grid.innerHTML = '';
    
    templates.forEach((template, index) => {
      const card = document.createElement('div');
      card.className = 'template-card';
      card.style.animationDelay = (index * 0.05) + 's';
      card.innerHTML = `
        <div style="display: flex; align-items: flex-start; gap: 14px;">
          <div style="width: 48px; height: 48px; background: rgba(${hexToRgb(template.color)},0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
            <i data-lucide="${template.icon}" style="width: 24px; height: 24px; color: ${template.color};"></i>
          </div>
          <div style="flex: 1;">
            <div style="color: #fff; font-weight: 600; font-size: 14px; margin-bottom: 6px;">${template.name}</div>
            <div style="color: #94a3b8; font-size: 12px; line-height: 1.4;">${template.description}</div>
          </div>
        </div>
      `;
      card.addEventListener('click', () => loadTemplate(template));
      grid.appendChild(card);
    });
  }

  function renderAutomations() {
    const list = document.getElementById('automationsList');
    list.innerHTML = '';
    
    automations.forEach((auto, index) => {
      const item = document.createElement('div');
      item.className = 'automation-item';
      item.style.animationDelay = (index * 0.05) + 's';
      
      const statusColor = auto.status === 'active' ? '#22C55E' : '#94a3b8';
      
      item.innerHTML = `
        <div>
          <div style="color: #fff; font-weight: 600; font-size: 14px; margin-bottom: 4px;">${auto.name}</div>
          <div style="color: #94a3b8; font-size: 12px;">${auto.trigger} → ${auto.actions}</div>
        </div>
        
        <div style="color: #94a3b8; font-size: 12px; text-align: center;">
          <div style="color: #64748b; font-size: 10px; margin-bottom: 2px;">Last Run</div>
          ${formatTime(auto.lastRun)}
        </div>
        
        <div style="color: #94a3b8; font-size: 12px; text-align: center;">
          <div style="color: #64748b; font-size: 10px; margin-bottom: 2px;">Runs</div>
          <span style="color: #3B82F6; font-weight: 600; font-family: 'Orbitron', monospace;">${auto.runCount.toLocaleString()}</span>
        </div>
        
        <div class="toggle-switch ${auto.status}" data-id="${auto.id}" title="${auto.status === 'active' ? 'Active' : 'Paused'}"></div>
        
        <button class="edit-auto-btn" data-id="${auto.id}" style="background: none; border: none; color: #94a3b8; cursor: pointer; padding: 8px; border-radius: 6px; transition: all 0.2s;">
          <i data-lucide="settings" style="width: 18px; height: 18px;"></i>
        </button>
      `;
      
      list.appendChild(item);
    });
    
    // Add toggle listeners
    list.querySelectorAll('.toggle-switch').forEach(toggle => {
      toggle.addEventListener('click', (e) => {
        e.stopPropagation();
        const id = toggle.dataset.id;
        toggleAutomation(id);
      });
    });
    
    if (window.lucide) window.lucide.createIcons();
  }

  function renderLogs(filter = {}) {
    const container = document.getElementById('logsTable');
    container.innerHTML = '';
    
    let filteredLogs = logs;
    if (filter.status && filter.status !== 'all') {
      filteredLogs = filteredLogs.filter(l => l.status === filter.status);
    }
    
    filteredLogs.forEach((log, index) => {
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.style.animationDelay = (index * 0.03) + 's';
      
      const statusIcon = log.status === 'success' ? 'check-circle' : log.status === 'failed' ? 'x-circle' : 'skip-forward';
      
      entry.innerHTML = `
        <div class="status-badge status-${log.status}">
          <i data-lucide="${statusIcon}" style="width: 14px; height: 14px;"></i>
          ${log.status.toUpperCase()}
        </div>
        
        <div>
          <div style="color: #fff; font-size: 13px; font-weight: 500; margin-bottom: 2px;">${log.automation}</div>
          <div style="color: #94a3b8; font-size: 12px;">${log.message}</div>
        </div>
        
        <div style="color: #64748b; font-size: 11px;">${formatTime(log.timestamp)}</div>
        
        <button style="background: none; border: none; color: #64748b; cursor: pointer; padding: 4px;">
          <i data-lucide="chevron-right" style="width: 16px; height: 16px;"></i>
        </button>
      `;
      
      container.appendChild(entry);
    });
    
    if (window.lucide) window.lucide.createIcons();
  }

  function setupEventListeners() {
    document.getElementById('createAutomationBtn').addEventListener('click', () => {
      document.getElementById('workflowBuilder').style.display = 'block';
      document.getElementById('workflowBuilder').scrollIntoView({ behavior: 'smooth' });
    });
    
    document.getElementById('cancelWorkflowBtn').addEventListener('click', () => {
      document.getElementById('workflowBuilder').style.display = 'none';
      resetWorkflow();
    });
    
    document.getElementById('saveWorkflowBtn').addEventListener('click', saveWorkflow);
    
    document.getElementById('viewLogsBtn').addEventListener('click', () => {
      document.getElementById('logsModal').style.display = 'flex';
    });
    
    document.getElementById('closeLogsBtn').addEventListener('click', () => {
      document.getElementById('logsModal').style.display = 'none';
    });
    
    document.getElementById('logFilterStatus').addEventListener('change', (e) => {
      renderLogs({ status: e.target.value });
    });
    
    // Close modals on outside click
    document.getElementById('logsModal').addEventListener('click', (e) => {
      if (e.target.id === 'logsModal') document.getElementById('logsModal').style.display = 'none';
    });
  }

  function toggleAutomation(id) {
    const auto = automations.find(a => a.id === id);
    if (auto) {
      auto.status = auto.status === 'active' ? 'paused' : 'active';
      localStorage.setItem('automations', JSON.stringify(automations));
      renderAutomations();
    }
  }

  function loadTemplate(template) {
    document.getElementById('workflowBuilder').style.display = 'block';
    document.getElementById('workflowName').value = template.name;
    document.getElementById('workflowBuilder').scrollIntoView({ behavior: 'smooth' });
    
    // Pre-populate workflow with template steps
    currentWorkflow = template.steps.map(step => {
      const [type, action] = step.split(':');
      return { type, action, id: Date.now() + Math.random() };
    });
    
    renderWorkflow();
  }

  function renderWorkflow() {
    const canvas = document.getElementById('workflowNodes');
    const emptyState = document.getElementById('emptyWorkflowState');
    
    if (currentWorkflow.length === 0) {
      emptyState.style.display = 'block';
      return;
    }
    
    emptyState.style.display = 'none';
    
    // Keep start node, remove others
    const startNode = canvas.querySelector('.trigger-node');
    canvas.innerHTML = '';
    canvas.appendChild(startNode);
    
    // Add connector
    const connector = document.createElement('div');
    connector.className = 'workflow-connector';
    connector.style.setProperty('--from-color', '#8b5cf6');
    connector.style.setProperty('--to-color', '#3B82F6');
    canvas.appendChild(connector);
    
    // Add workflow steps
    currentWorkflow.forEach((step, index) => {
      const stepEl = createWorkflowStep(step, index);
      canvas.appendChild(stepEl);
      
      if (index < currentWorkflow.length - 1) {
        const nextConnector = document.createElement('div');
        nextConnector.className = 'workflow-connector';
        const colors = ['#3B82F6', '#eab308', '#06B6D4', '#8b5cf6'];
        nextConnector.style.setProperty('--from-color', colors[index % colors.length]);
        nextConnector.style.setProperty('--to-color', colors[(index + 1) % colors.length]);
        canvas.appendChild(nextConnector);
      }
    });
    
    // Add final placeholder
    const placeholder = document.createElement('div');
    placeholder.id = 'addStepPlaceholder';
    placeholder.style.cssText = 'width: 280px; padding: 30px; border: 2px dashed rgba(148,163,184,0.3); border-radius: 16px; text-align: center; cursor: pointer; transition: all 0.3s;';
    placeholder.innerHTML = `
      <i data-lucide="plus-circle" style="width: 32px; height: 32px; color: #94a3b8; margin-bottom: 8px;"></i>
      <div style="color: #94a3b8; font-size: 13px;">Add another step</div>
    `;
    canvas.appendChild(placeholder);
    
    if (window.lucide) window.lucide.createIcons();
  }

  function createWorkflowStep(step, index) {
    const div = document.createElement('div');
    div.className = `workflow-step ${step.type}`;
    div.style.animationDelay = (index * 0.1) + 's';
    
    const icons = {
      trigger: 'lightning',
      action: 'zap',
      condition: 'git-branch',
      delay: 'clock'
    };
    
    const colors = {
      trigger: '#8b5cf6',
      action: '#3B82F6',
      condition: '#eab308',
      delay: '#06B6D4'
    };
    
    div.innerHTML = `
      <div style="display: flex; align-items: center; gap: 12px;">
        <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
          <i data-lucide="${icons[step.type]}" style="width: 20px; height: 20px; color: ${colors[step.type]};"></i>
        </div>
        <div style="flex: 1;">
          <div style="color: #fff; font-size: 14px; font-weight: 600; text-transform: capitalize;">${step.action.replace('_', ' ')}</div>
          <div style="color: #94a3b8; font-size: 12px; text-transform: capitalize;">${step.type} Step</div>
        </div>
        <button class="remove-step" data-index="${index}" style="background: none; border: none; color: #64748b; cursor: pointer; padding: 4px; opacity: 0; transition: opacity 0.2s;">
          <i data-lucide="x" style="width: 16px; height: 16px;"></i>
        </button>
      </div>
    `;
    
    div.addEventListener('mouseenter', () => {
      div.querySelector('.remove-step').style.opacity = '1';
    });
    div.addEventListener('mouseleave', () => {
      div.querySelector('.remove-step').style.opacity = '0';
    });
    
    div.querySelector('.remove-step').addEventListener('click', () => {
      currentWorkflow.splice(index, 1);
      renderWorkflow();
    });
    
    return div;
  }

  function saveWorkflow() {
    const name = document.getElementById('workflowName').value;
    if (!name) {
      Toast.warning('Please name your automation before saving');
      return;
    }
    
    const newAuto = {
      id: 'AUTO' + String(automations.length + 1).padStart(3, '0'),
      name: name,
      trigger: currentWorkflow[0]?.action.replace('_', ' ') || 'Manual',
      actions: currentWorkflow.length + ' steps',
      status: 'active',
      lastRun: 'Never',
      runCount: 0
    };
    
    automations.push(newAuto);
    localStorage.setItem('automations', JSON.stringify(automations));
    
    renderAutomations();
    document.getElementById('workflowBuilder').style.display = 'none';
    resetWorkflow();
  }

  function resetWorkflow() {
    currentWorkflow = [];
    document.getElementById('workflowName').value = '';
    const canvas = document.getElementById('workflowNodes');
    canvas.innerHTML = `
      <div class="workflow-node trigger-node" style="width: 280px; padding: 20px; background: linear-gradient(135deg, rgba(139,92,246,0.2), rgba(139,92,246,0.1)); border: 2px solid #8b5cf6; border-radius: 16px; position: relative; z-index: 2;">
        <div style="display: flex; align-items: center; gap: 12px;">
          <div style="width: 40px; height: 40px; background: rgba(139,92,246,0.3); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
            <i data-lucide="play" style="width: 20px; height: 20px; color: #8b5cf6;"></i>
          </div>
          <div style="flex: 1;">
            <div style="color: #fff; font-size: 14px; font-weight: 600;">Start</div>
            <div style="color: #94a3b8; font-size: 12px;">Click to set trigger</div>
          </div>
        </div>
      </div>
      <div style="width: 2px; height: 40px; background: linear-gradient(180deg, #8b5cf6, #3B82F6); position: relative;">
        <div class="connection-anim" style="position: absolute; width: 6px; height: 6px; background: #fff; border-radius: 50%; left: 50%; transform: translateX(-50%); animation: flowDown 1.5s linear infinite;"></div>
      </div>
      <div id="addStepPlaceholder" style="width: 280px; padding: 30px; border: 2px dashed rgba(148,163,184,0.3); border-radius: 16px; text-align: center; cursor: pointer; transition: all 0.3s;">
        <i data-lucide="plus-circle" style="width: 32px; height: 32px; color: #94a3b8; margin-bottom: 8px;"></i>
        <div style="color: #94a3b8; font-size: 13px;">Add your first step</div>
      </div>
    `;
  }

  function formatTime(timestamp) {
    const date = new Date(timestamp);
    const now = new Date();
    const diff = (now - date) / 1000 / 60; // minutes
    
    if (diff < 1) return 'Just now';
    if (diff < 60) return `${Math.floor(diff)}m ago`;
    if (diff < 1440) return `${Math.floor(diff / 60)}h ago`;
    return date.toLocaleDateString();
  }

  function hexToRgb(hex) {
    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? 
      `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : 
      '59, 130, 246';
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>