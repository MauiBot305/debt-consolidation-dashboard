<!-- Gamification - SPA Fragment (converted from standalone) -->
<div class="gamification-page p-6 max-w-7xl mx-auto">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-white mb-1">ðŸŽ® Gamification Hub</h1>
    <p class="text-gray-400">Compete, earn, and dominate the leaderboard</p>
  </div>

  <!-- Leaderboard -->
  <div class="bg-slate-800/30 backdrop-blur-sm rounded-2xl border border-slate-700/50 overflow-hidden mb-8">
    <div class="p-6 border-b border-slate-700/50">
      <h2 class="text-2xl font-semibold text-white flex items-center gap-2">
        <i data-lucide="trophy" class="w-6 h-6 text-yellow-400"></i>
        Leaderboard
      </h2>
    </div>
    <div class="p-6">
      <div id="leaderboard" class="space-y-3">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>

  <!-- Achievements -->
  <div class="bg-slate-800/30 backdrop-blur-sm rounded-2xl border border-slate-700/50 overflow-hidden mb-8">
    <div class="p-6 border-b border-slate-700/50">
      <h2 class="text-2xl font-semibold text-white flex items-center gap-2">
        <i data-lucide="award" class="w-6 h-6 text-purple-400"></i>
        Achievements
      </h2>
    </div>
    <div class="p-6">
      <div id="achievementsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>

  <!-- Active Challenges -->
  <div class="bg-slate-800/30 backdrop-blur-sm rounded-2xl border border-slate-700/50 overflow-hidden mb-8">
    <div class="p-6 border-b border-slate-700/50">
      <h2 class="text-2xl font-semibold text-white flex items-center gap-2">
        <i data-lucide="zap" class="w-6 h-6 text-orange-400"></i>
        Active Challenges
      </h2>
    </div>
    <div class="p-6">
      <div id="challengesContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>

  <!-- Rewards Catalog -->
  <div class="bg-slate-800/30 backdrop-blur-sm rounded-2xl border border-slate-700/50 overflow-hidden mb-8">
    <div class="p-6 border-b border-slate-700/50">
      <h2 class="text-2xl font-semibold text-white flex items-center gap-2">
        <i data-lucide="gift" class="w-6 h-6 text-emerald-400"></i>
        Rewards Catalog
      </h2>
    </div>
    <div class="p-6">
      <div id="rewardsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>

  <!-- Agent Profile (selected agent) -->
  <div id="agentProfile" class="bg-slate-800/30 backdrop-blur-sm rounded-2xl border border-slate-700/50 overflow-hidden" style="display: none;">
    <div class="p-6 border-b border-slate-700/50 flex items-center justify-between">
      <h2 class="text-2xl font-semibold text-white flex items-center gap-2">
        <i data-lucide="user" class="w-6 h-6 text-blue-400"></i>
        Agent Profile
      </h2>
      <button onclick="closeAgentProfile()" class="text-gray-400 hover:text-white">
        <i data-lucide="x" class="w-5 h-5"></i>
      </button>
    </div>
    <div class="p-6">
      <div id="agentProfileContent">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>
</div>


  <style>
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
      50% { box-shadow: 0 0 40px rgba(59, 130, 246, 0.8); }
    }
    .medal { animation: pulse-glow 2s infinite; }
  </style>

<script>
(function() {
'use strict';
// Toast Function
  function showToast(msg, type='info') {
    const toast = document.createElement('div');
    const colors = {
      success: 'bg-emerald-500',
      error: 'bg-red-500',
      info: 'bg-blue-500'
    };
    toast.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50`;
    toast.textContent = msg;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
  }

  // Check DebtDB
  if (!window.DebtDB) {
    showToast('DebtDB not loaded!', 'error');
  }

  // Achievements library
  const ACHIEVEMENTS = [
    { id: 'first_call', name: 'First Call', icon: 'ðŸ“ž', description: 'Make your first call', points: 10, requirement: 1 },
    { id: '10_calls', name: '10 Calls', icon: 'ðŸŽ¯', description: 'Make 10 calls', points: 50, requirement: 10 },
    { id: '100_calls', name: '100 Calls', icon: 'ðŸš€', description: 'Make 100 calls', points: 200, requirement: 100 },
    { id: 'first_deal', name: 'First Deal', icon: 'ðŸ’°', description: 'Close your first deal', points: 100, requirement: 1 },
    { id: '10_deals', name: '10 Deals', icon: 'ðŸ†', description: 'Close 10 deals', points: 500, requirement: 10 },
    { id: 'perfect_week', name: 'Perfect Week', icon: 'â­', description: '100% conversion for a week', points: 300, requirement: 1 },
    { id: '100k_revenue', name: '$100K Revenue', icon: 'ðŸ’Ž', description: 'Generate $100K in revenue', points: 1000, requirement: 100000 },
  ];

  function renderLeaderboard() {
    const leaderboard = window.DebtDB?.getLeaderboard?.() || window.DebtDB?.getAgents?.() || [];
    const container = document.getElementById('leaderboard');
    
    container.innerHTML = leaderboard.slice(0, 10).map((agent, index) => {
      const medals = ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰'];
      const medal = index < 3 ? medals[index] : '';
      
      return `
        <div onclick="viewAgentProfile('${agent.id}')" class="flex items-center gap-4 p-4 rounded-xl ${index < 3 ? 'bg-gradient-to-r from-yellow-500/10 to-orange-500/10 border border-yellow-500/30' : 'bg-slate-800/50'} hover:bg-slate-700/50 transition-all cursor-pointer">
          <div class="text-3xl font-bold text-gray-500" style="font-family: 'Orbitron', monospace; min-width: 40px;">
            ${medal || '#' + (index + 1)}
          </div>
          <div class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-xl">
            ${agent.name?.charAt(0) || 'A'}
          </div>
          <div class="flex-1">
            <div class="text-white font-semibold">${agent.name}</div>
            <div class="text-sm text-gray-400">Level ${agent.level || 1} â€¢ ${agent.stats?.calls_made || 0} calls</div>
          </div>
          <div class="text-right">
            <div class="text-2xl font-bold text-blue-400" style="font-family: 'Orbitron', monospace;">${agent.score || 0}</div>
            <div class="text-xs text-gray-500">points</div>
          </div>
        </div>
      `;
    }).join('');
    
    if (typeof lucide !== 'undefined' && lucide.createIcons) { try { lucide.createIcons(); } catch(e) { console.warn('[Lucide]', e.message); } }
  }

  function renderAchievements() {
    const container = document.getElementById('achievementsGrid');
    
    container.innerHTML = ACHIEVEMENTS.map(ach => {
      const unlocked = agent && agent.stats ? (function() { switch(achievement.id || achievement.name) { case 'first_call': return agent.stats.callsToday > 0; case 'ten_enrollments': return agent.stats.enrollments >= 10; case 'revenue_milestone': return agent.stats.revenue >= 10000; default: return false; } })() : false;
      
      return `
        <div class="p-4 rounded-xl border ${unlocked ? 'bg-gradient-to-br from-purple-500/20 to-blue-500/20 border-purple-500/50' : 'bg-slate-800/30 border-slate-700/50 opacity-60'} relative overflow-hidden">
          ${unlocked ? '<div class="absolute top-2 right-2 text-yellow-400"><i data-lucide="check-circle" class="w-5 h-5"></i></div>' : ''}
          <div class="text-4xl mb-2">${ach.icon}</div>
          <div class="text-white font-semibold mb-1">${ach.name}</div>
          <div class="text-sm text-gray-400 mb-2">${ach.description}</div>
          <div class="text-xs text-blue-400 font-mono" style="font-family: 'Orbitron', monospace;">+${ach.points} pts</div>
        </div>
      `;
    }).join('');
    
    if (typeof lucide !== 'undefined' && lucide.createIcons) { try { lucide.createIcons(); } catch(e) { console.warn('[Lucide]', e.message); } }
  }

  function renderChallenges() {
    const challenges = [
      { id: 'daily_hustle', name: 'Daily Hustle', period: 'Daily', goal: 50, current: 32, metric: 'calls', reward: 100, endTime: '11:59 PM' },
      { id: 'weekly_warrior', name: 'Weekly Warrior', period: 'Weekly', goal: 10, current: 7, metric: 'deals', reward: 500, endTime: 'Sunday' },
      { id: 'monthly_master', name: 'Monthly Master', period: 'Monthly', goal: 50000, current: 32000, metric: 'revenue', reward: 2000, endTime: 'End of Month' }
    ];
    
    const container = document.getElementById('challengesContainer');
    
    container.innerHTML = challenges.map(ch => {
      const progress = (ch.current / ch.goal * 100).toFixed(1);
      
      return `
        <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6">
          <div class="flex items-center justify-between mb-4">
            <div>
              <div class="text-white font-semibold text-lg">${ch.name}</div>
              <div class="text-sm text-gray-400">${ch.period} â€¢ Ends ${ch.endTime}</div>
            </div>
            <div class="text-yellow-400 font-bold text-xl font-mono" style="font-family: 'Orbitron', monospace;">+${ch.reward}</div>
          </div>
          
          <div class="mb-2">
            <div class="flex justify-between text-sm mb-1">
              <span class="text-gray-400">${ch.current} / ${ch.goal} ${ch.metric}</span>
              <span class="text-blue-400 font-mono" style="font-family: 'Orbitron', monospace;">${progress}%</span>
            </div>
            <div class="h-3 bg-slate-700 rounded-full overflow-hidden">
              <div class="h-full bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full transition-all duration-500" style="width: ${progress}%"></div>
            </div>
          </div>
        </div>
      `;
    }).join('');
  }

  function renderRewards() {
    const rewards = [
      { id: 'r1', name: 'Extra PTO Day', cost: 1000, icon: 'ðŸ–ï¸', available: true },
      { id: 'r2', name: '$50 Gift Card', cost: 500, icon: 'ðŸŽ', available: true },
      { id: 'r3', name: 'Premium Parking Spot', cost: 750, icon: 'ðŸš—', available: true },
      { id: 'r4', name: 'Team Lunch', cost: 1500, icon: 'ðŸ•', available: true },
      { id: 'r5', name: 'Work From Home Day', cost: 800, icon: 'ðŸ¡', available: true },
      { id: 'r6', name: 'Early Leave Pass', cost: 600, icon: 'â°', available: true },
    ];
    
    const container = document.getElementById('rewardsGrid');
    
    container.innerHTML = rewards.map(r => {
      return `
        <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 hover:border-emerald-500/50 transition-all cursor-pointer" onclick="redeemReward('${r.id}')">
          <div class="text-5xl mb-3 text-center">${r.icon}</div>
          <div class="text-white font-semibold text-center mb-2">${r.name}</div>
          <div class="text-center">
            <div class="inline-block px-4 py-2 bg-emerald-500/20 text-emerald-400 rounded-lg font-mono text-sm" style="font-family: 'Orbitron', monospace;">
              ${r.cost} pts
            </div>
          </div>
          ${!r.available ? '<div class="text-center text-xs text-gray-500 mt-2">Out of Stock</div>' : ''}
        </div>
      `;
    }).join('');
  }

  function viewAgentProfile(agentId) {
    const agent = window.DebtDB.getAgent(agentId);
    if (!agent) return;
    
    const stats = window.DebtDB.getAgentStats(agentId);
    const level = stats.level || 1;
    const points = stats.points || 0;
    const nextLevelPoints = level * 1000;
    const xpProgress = ((points % 1000) / 1000 * 100).toFixed(1);
    
    const profileEl = document.getElementById('agentProfile');
    const contentEl = document.getElementById('agentProfileContent');
    
    contentEl.innerHTML = `
      <div class="flex items-center gap-6 mb-6">
        <div class="w-24 h-24 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-4xl">
          ${agent.name?.charAt(0) || 'A'}
        </div>
        <div class="flex-1">
          <h3 class="text-2xl font-bold text-white mb-1">${agent.name}</h3>
          <div class="text-gray-400">Level ${level} â€¢ ${points} points</div>
          <div class="text-sm text-gray-500">ðŸ”¥ ${stats.currentStreak || 0} day streak</div>
        </div>
      </div>
      
      <div class="mb-6">
        <div class="flex justify-between text-sm mb-2">
          <span class="text-gray-400">XP Progress</span>
          <span class="text-blue-400 font-mono" style="font-family: 'Orbitron', monospace;">${xpProgress}%</span>
        </div>
        <div class="h-4 bg-slate-700 rounded-full overflow-hidden">
          <div class="h-full bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full transition-all" style="width: ${xpProgress}%"></div>
        </div>
        <div class="text-xs text-gray-500 mt-1">${points % 1000} / 1000 to Level ${level + 1}</div>
      </div>
      
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="bg-slate-800/50 rounded-xl p-4">
          <div class="text-gray-400 text-sm mb-1">Calls Made</div>
          <div class="text-2xl font-bold text-white font-mono" style="font-family: 'Orbitron', monospace;">${stats.calls_made || 0}</div>
        </div>
        <div class="bg-slate-800/50 rounded-xl p-4">
          <div class="text-gray-400 text-sm mb-1">Deals Closed</div>
          <div class="text-2xl font-bold text-white font-mono" style="font-family: 'Orbitron', monospace;">${stats.deals_closed || 0}</div>
        </div>
        <div class="bg-slate-800/50 rounded-xl p-4">
          <div class="text-gray-400 text-sm mb-1">Revenue</div>
          <div class="text-2xl font-bold text-white font-mono" style="font-family: 'Orbitron', monospace;">$${(stats.revenue_generated || 0).toLocaleString()}</div>
        </div>
        <div class="bg-slate-800/50 rounded-xl p-4">
          <div class="text-gray-400 text-sm mb-1">Avg Call Time</div>
          <div class="text-2xl font-bold text-white font-mono" style="font-family: 'Orbitron', monospace;">${stats.avg_call_duration || 0}m</div>
        </div>
      </div>
      
      <div>
        <h4 class="text-white font-semibold mb-3">Achievements</h4>
        <div class="flex flex-wrap gap-2">
          ${ACHIEVEMENTS.slice(0, 3).map(a => `
            <div class="px-3 py-2 bg-purple-500/20 border border-purple-500/50 rounded-lg text-sm">
              ${a.icon} ${a.name}
            </div>
          `).join('')}
        </div>
      </div>
    `;
    
    profileEl.style.display = 'block';
    if (typeof lucide !== 'undefined' && lucide.createIcons) { try { lucide.createIcons(); } catch(e) { console.warn('[Lucide]', e.message); } }
  }

  function closeAgentProfile() {
    document.getElementById('agentProfile').style.display = 'none';
  }

  function redeemReward(rewardId) {
    showToast('Reward redeemed! (Demo mode)', 'success');
  }

  function initGamification() {
    renderLeaderboard();
    renderAchievements();
    renderChallenges();
    renderRewards();
    if (typeof lucide !== 'undefined' && lucide.createIcons) { try { lucide.createIcons(); } catch(e) { console.warn('[Lucide]', e.message); } }
  }

  // Initialize
  if (document.readyState === 'loading') {
    if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', initGamification); } else { initGamification(); }
  } else {
    initGamification();
  }

// Window exports for onclick handlers
  window.closeAgentProfile = closeAgentProfile;
  window.redeemReward = redeemReward;
  window.viewAgentProfile = viewAgentProfile;
})();
</script>
